<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Select.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Select.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as Color from "./Color.js";

/**
 * Handle click selection and mark elements as selected.
 * @constructor
 * @param {DragHandler} dragHandler - An instantiated DragHandler object.
 * @param {NeonView} neonView - The NeonView parent.
 */
function Select (dragHandler, neonView) {
    var lastSelect = new Array(0);
    selectListeners();
    //Selection mode toggle
    function selectListeners() {
        var classesToSelect = ".nc, .clef, .custos";
        $("#selByNeume").on("click", function(){
            if (!$("#selByNeume").hasClass("is-active")){
                $("#selByNeume").addClass("is-active");
                $("#selByNc").removeClass("is-active");
                $("#selByStaff").removeClass("is-active");
            }           
        });

        $("#selByNc").on("click", function(){
            if (!$("#selByNc").hasClass("is-active")) {
                $("#selByNc").addClass("is-active");
                $("#selByNeume").removeClass("is-active");
                $("#selByStaff").removeClass("is-active");
            }
        });

        $("#selByStaff").on("click", function () {
            if (!$("#selByStaff").hasClass("is-active")) {
                $("#selByStaff").addClass("is-active");
                $("#selByNc").removeClass("is-active");
                $("#selByNeume").removeClass("is-active");
            }
        });

        //Activating selected neumes
        $(classesToSelect).on("click", function() {
            var isNc= $(this).hasClass("nc");
            if ($("#selByNeume").hasClass("is-active") &amp;&amp; isNc){
                if(!$(this).hasClass("selected")){
                    unselect();
                    $(this).attr("fill", "#d00");
                    $(this).addClass("selected");
                    var siblings = Array.from($(this).siblings());
                    siblings.forEach(el => {
                        if(!$(el).hasClass("selected")){
                            $(el).attr("fill", "#d00");
                            $(el).addClass("selected");
                        }   
                    }) 
                    if(siblings.length != 0){
                        triggerNeumeActions();  
                    }     
                    else{
                        triggerNcActions();
                    }          
                    dragHandler.dragInit();   
                }
            }
            else if ($("#selByNc").hasClass("is-active") || !(isNc || $("#selByStaff").hasClass("is-active"))){
                if(!$(this).hasClass("selected")){
                    unselect();
                    $(this).attr("fill", "#d00");
                    $(this).addClass("selected");
                    triggerNcActions();
                    dragHandler.dragInit();
                }
            }
            else if ($("#selByStaff").hasClass("is-active")) {
                var staff = $(this).parents(".staff");
                if (!staff.hasClass("selected")) {
                    unselect();
                    staff.addClass("selected");
                    Color.highlight(staff[0], "#d00");
                    triggerStaffActions(neonView);
                    dragHandler.dragInit();
                }
            }
            else {
                console.log("error: selection mode not activated");
                return;
            }
            lastSelect = Array.from($(".selected"));
        })

        // click away listeners
        $("body").on("keydown", (evt) => { // click
            if (evt.type === "keydown" &amp;&amp; evt.key !== "Escape") return;
            endOptionsSelection();
            unselect();
        })

        $(classesToSelect).on("click", function(e){
            e.stopPropagation();
        })

        $("#moreEdit").on("click", function(e) {
            e.stopPropagation();
        })

        function unselect() {
            var els = $(".selected");
            for (var i=0; i&lt;els.length; i++){
                if ($(els[i]).hasClass("staff")) {
                    $(els[i]).removeClass("selected");
                    unhighlight(els[i]);
                } else {
                    $(els[i]).removeClass("selected").attr("fill", null);
                }
            }

            if ($("#highlightStaves").is(":checked")) {
                Color.setStaffHighlight();
            }
        }
    }

    //TODO: CHANGE NAVABAR-LINK TO PROPER ICON//
    function triggerNcActions() {
        endOptionsSelection();
        $("#moreEdit").removeClass("is-invisible");
        $("#moreEdit").append(
            "&lt;label>Change Head Shape:&amp;nbsp;&lt;/label>" +
            "&lt;div id='drop_select' class='dropdown'>" +
            "&lt;div class='dropdown-trigger'>" +
            "&lt;button id='select-options' class='button navbar-link' aria-haspopup='true' aria-controls='dropdown-menu'>" +
            "&lt;span>Head Shapes&lt;/span>&lt;span class='icon is-small'>" +
            "&lt;i class=''>&lt;/i>&lt;/span>&lt;/button>&lt;/div>" +
            "&lt;div class='dropdown-menu' id='dropdown-menu' role='menu'>" +
            "&lt;div class='dropdown-content'>" +
            "&lt;a id='Punctum' class='dropdown-item'>Punctum&lt;/a>" +
            "&lt;a id='Virga' class='dropdown-item'>Virga&lt;/a>" +
            "&lt;a id='Inclinatum' class='dropdown-item'>Inclinatum&lt;/a>&lt;/div>&lt;/div>&lt;/div>"
        );
        
        $("#Punctum.dropdown-item").on("click", (evt) => {
            let unsetInclinatum = {
                "action": "set",
                "param": {
                    "elementId": lastSelect[0].id,
                    "attrType": "name",
                    "attrValue": ""
                }
            };
            let unsetVirga = {
                "action": "set",
                "param": {
                    "elementId": lastSelect[0].id,
                    "attrType": "diagonalright",
                    "attrValue": ""
                }
            };
            neonView.edit({ "action": "chain", "param": [ unsetInclinatum, unsetVirga ]});
            neonView.refreshPage();
        });

        $("#Inclinatum.dropdown-item").on("click", (evt) => {
            let setInclinatum = {
                "action": "set",
                "param": {
                    "elementId": lastSelect[0].id,
                    "attrType": "name",
                    "attrValue": "inclinatum"
                }
            };
            let unsetVirga = {
                "action": "set",
                "param": {
                    "elementId": lastSelect[0].id,
                    "attrType": "diagonalright",
                    "attrValue": ""
                }
            };
            neonView.edit({ "action": "chain", "param": [ setInclinatum, unsetVirga ]});
            neonView.refreshPage();
        });
        
        $("#Virga.dropdown-item").on("click", (evt) => {
            let unsetInclinatum = {
                "action": "set",
                "param": {
                    "elementId": lastSelect[0].id,
                    "attrType": "name",
                    "attrValue": ""
                }
            };
            let setVirga = {
                "action": "set",
                "param": {
                    "elementId": lastSelect[0].id,
                    "attrType": "diagonalright",
                    "attrValue": "u"
                }
            };
            neonView.edit({ "action": "chain", "param": [ unsetInclinatum, setVirga ]});
            neonView.refreshPage();
        });

        initOptionsListeners();
    }
    //TODO: CHANGE NAVABAR-LINK TO PROPER ICON//
    function triggerNeumeActions() {
        endOptionsSelection()
        $("#moreEdit").removeClass("is-invisible");
        $("#moreEdit").append(
            "&lt;label>Change Grouping:&amp;nbsp;&lt;/label>" +
            "&lt;div id='drop_select' class='dropdown'>" +
            "&lt;div class='dropdown-trigger'>" +
            "&lt;button id='select-options' class='button navbar-link' aria-haspopup='true' aria-controls='dropdown-menu'>" +
            "&lt;span>Groupings&lt;/span>&lt;span class='icon is-small'>" +
            "&lt;i class=''>&lt;/i>&lt;/span>&lt;/button>&lt;/div>" +
            "&lt;div class='dropdown-menu' id='dropdown-menu' role='menu'>" +
            "&lt;div class='dropdown-content'>" +
            "&lt;a id='Torculus' class='dropdown-item'>Torculus&lt;/a>&lt;/div>&lt;/div>&lt;/div>" +
            "&lt;div>&lt;p class='control'>" +
            "&lt;button class='button' id='ungroup'>Ungroup&lt;/button>&lt;/p>&lt;/div>"
        );

        initOptionsListeners();
    }


    function endOptionsSelection () {
        $("#moreEdit").empty();
        $("#moreEdit").addClass("is-invisible");
    }

    function initOptionsListeners(){
        $("#drop_select").on("click", function() {
            $(this).toggleClass("is-active");
        })
    }

    Select.prototype.selectListeners = selectListeners;
}

export function triggerStaffActions(neonView) {
    $("#moreEdit").empty();
    $("#moreEdit").addClass("is-invisible");
    $("#moreEdit").removeClass("is-invisible");
    $("#moreEdit").append(
        "&lt;label>Merge Systems:&amp;nbsp;&lt;/label>" +
        "&lt;div>&lt;p class='control'>" +
        "&lt;button id='merge-systems' class='button'>Merge&lt;/button>&lt;/p>&lt;/div>"
    );
    
    $("#drop_select").on("click", function() {
        $(this).toggleClass("is-active");
    });
    $("#merge-systems").on("click", (evt) => {
        let systems = Array.from($(".staff.selected"));
        let elementIds = [];
        systems.forEach(staff => {
            elementIds.push(staff.id);
        });
        let editorAction = {
            "action": "merge",
            "param": {
                "elementIds": elementIds
            }
        };

        if (neonView.edit(editorAction)) {
            neonView.refreshPage();
        }
        else {
            alert("Could not merge systems. :(");
        }
    });
}
export {Select as default};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Color.html">Color</a></li><li><a href="module-Contents.html">Contents</a></li><li><a href="module-Controls.html">Controls</a></li><li><a href="module-Cursor.html">Cursor</a></li><li><a href="module-Neon.html">Neon</a></li><li><a href="module-Zoom.html">Zoom</a></li></ul><h3>Classes</h3><ul><li><a href="DragHandler.html">DragHandler</a></li><li><a href="DragSelect.html">DragSelect</a></li><li><a href="EditMode.html">EditMode</a></li><li><a href="GroupingHandler.html">GroupingHandler</a></li><li><a href="InfoBox.html">InfoBox</a></li><li><a href="InsertHandler.html">InsertHandler</a></li><li><a href="module-Neon-Neon.html">Neon</a></li><li><a href="module-Zoom.ViewBox.html">ViewBox</a></li><li><a href="module-Zoom-ZoomHandler.html">ZoomHandler</a></li><li><a href="NeonView.html">NeonView</a></li><li><a href="Select.html">Select</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Jul 19 2018 14:27:49 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
